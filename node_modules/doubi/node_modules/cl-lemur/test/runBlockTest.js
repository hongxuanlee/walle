var assert = require("assert");
var Engine = require("../lib/engine/engine.js");
var fs = require("fs");
var path = require("path");

describe("runBlockTest", function() {
	it("run block easy", function() {
		var engine = Engine.create();
		var source = fs.readFileSync(path.join(__dirname, "./testTmpl/runBlock/test1.tmpl"), "utf-8");
		var target = engine.compile(source);
		fs.writeFileSync(path.join(__dirname, "./result/runBlock/test1.js"), target, "utf-8");

		eval("var template = " + target);
		var result = template.run({
			data: {}
		}, {
			key: "id",
			value: "id1"
		});
		console.log(result);
		assert.equal("ok, this is block!", result);
	});

	it("run block with outter data", function() {
		var engine = Engine.create();
		var source = fs.readFileSync(path.join(__dirname, "./testTmpl/runBlock/test2.tmpl"), "utf-8");
		var target = engine.compile(source);
		fs.writeFileSync(path.join(__dirname, "./result/runBlock/test2.js"), target, "utf-8");

		eval("var template = " + target);
		var result = template.run({
			$block1Pass: "call from outter!"
		}, {
			key: "id",
			value: "block2"
		});
		console.log(result);
	});
});