var path = require("path");
var fs = require("fs");
var assert = require("assert");
var doubi = require("../lib/doubi.js");

describe("doubi: system plugins", function() {
	it("should work for script & body tag", function() {
		var tmplPath = path.join(__dirname, "./doubiPageTemplate/test1.tmpl");
		var source = fs.readFileSync(tmplPath, "utf-8");

		var doubiEngine = doubi.create();
		var target = doubiEngine.compile(source);
		fs.writeFileSync(path.join(__dirname, "./doubiPageTemplate/result/test1.js"), target, "utf-8");
		var text = eval(target).run();
		assert.equal("<!DOCTYPE html><html><head></head><body>feel good!<script>alert(1);alert(2);</script></body></html>", text);
	});

	it("should work for require & head tag", function() {
		var tmplPath = path.join(__dirname, "./doubiPageTemplate/test2.tmpl");
		var source = fs.readFileSync(tmplPath, "utf-8");

		var doubiEngine = doubi.create();
		var target = doubiEngine.compile(source);
		fs.writeFileSync(path.join(__dirname, "./doubiPageTemplate/result/test2.js"), target, "utf-8");
		var text = eval(target).run();
		assert.equal('<!DOCTYPE html><html><head><link href="b.css" rel="stylesheet"></head><body>ok1!ok2!<script src="a.js" type="text/javascript"><script></script></body></html>', text);
	});
});