var path = require("path");
var fs = require("fs");
var assert = require("assert");
var doubi = require("../lib/doubi.js");

describe("doubi: resource controll", function() {
	it("should work for getBlockResource", function() {
		var tmplPath = path.join(__dirname, "./doubiResTemplate/test1.tmpl");
		var source = fs.readFileSync(tmplPath, "utf-8");

		var doubiEngine = doubi.create();
		var target = doubiEngine.compile(source);
		fs.writeFileSync(path.join(__dirname, "./doubiResTemplate/result/test1.js"), target, "utf-8");
		var template = eval(target);
		var result1 = template.getBlockResource(null, {
			key: "id",
			value: "block1"
		});
		assert.equal(1, result1.js.length);
		assert.equal(1, result1.css.length);

		var result2 = template.getBlockResource(null, {
			key: "id",
			value: "block2"
		});
		assert.equal(0, result2.js.length);
		assert.equal(0, result2.css.length);
	});
});